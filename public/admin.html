<!DOCTYPE html>
<html>
<head>
	<title>Congregational Agent</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="admin.css">
    <link rel="stylesheet" href="admin.css">
      
	<script src="https://www.gstatic.com/firebasejs/4.8.2/firebase.js"></script>
	<script>
	  // Initialize Firebase
	  var config = {
		apiKey: "AIzaSyA9GSNr_y7G9nRoTXnJ7wNY9N7ACt9u8SA",
		authDomain: "maps-ca38f.firebaseapp.com",
		databaseURL: "https://maps-ca38f.firebaseio.com",
		projectId: "maps-ca38f",
		storageBucket: "maps-ca38f.appspot.com",
		messagingSenderId: "6568625724"
	  };
	  firebase.initializeApp(config);
	</script>
</head>
<body>
	
	<div id="loading_div">
		<div id="loader"></div>
	</div>
	
	<div id="nav_div">
		<div id="left_header_div" onclick="openNav()">
			<div id="menu_container">
				<div class="menu_style"></div>
				<div class="menu_style"></div>
				<div class="menu_style"></div>
			</div>
		</div>
			<div id="header_content_div"></div>
		<div id="right_header_div"></div>
	</div>
	
	<div id="side_nav" class="sidenav">
		<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
		<a onclick="navAddLocation()">Add Location</a>
		<div class="nav_divider_div"></div>
		<a onclick="navEditLocation()">Edit Locations</a>
		<div class="nav_divider_div"></div>
		<a onclick="navCheckFeedback()">Check Location Errors</a>
		<div class="nav_divider_div"></div>
		<a onclick="getMoreCredit()" id="location_credits">Location Credits</a>
		<div class="nav_divider_div"></div>
		<a onclick="information()">Tips and Information</a>
		<div class="nav_divider_div"></div>
		<a onclick="shoppingCart()">Cart and Checkout</a>
		<div class="nav_divider_div"></div>
		<a onclick="profile()">Edit Profile</a>
	</div>
	
	<div id="shadow_div"></div>
	
	<div id="content_div">
	
		<div id="right_content_div"></div>
		
		<div id="add_location_div_container">
			<div id="add_location_box">
				<center><h2 class="tags" id="add_new_location_title">Add new Location</h2></center>
				<center><p id="location_credits_remaining"></p></center>
				<center><button id="add_more_credits" onclick="getMoreCredit()">Add more credits</button></center>
				<div id="add_location_container">
					<div id="add_location_1">
						<input type="text" id="first_name" class="input" placeholder="First Name"><br>
						<input type="text" id="last_name" class="input" placeholder="Last Name"><br>
						<input type="text" id="address" class="input" placeholder="Address"><br>
						<input type="text" id="city" class="input" placeholder="City"><br>
						<h4 class="tags">Select State or Province</h4>
						<select id="state_select" class="select"></select>
					</div>
					<div id="add_location_2">
						<h4 class="tags">Select Congregation</h4>
						<select id="cong_select" class="select"></select>
						<p id="verify_location_explain">Sometime the exact location of the<br>household you are adding can not be<br>determined by just address alone.<br>Therefore you must verify that the pin<br>on the map is at the correct place before<br>adding.  If it is not on the correct place,<br>please select the location it should be<br>with your mouse.</p>
						<center><button id="verify_location_btn" onclick="verify_location()">Verify Location</button></center>
					</div>
				</div>
			<center><h3 id="message_center_add_location"></h3></center>
			<div id="add_location_loader"></div>	
			</div>
			<div id="maps_div">
				<center><h2 id="must_verify">Verify new location</h2></center>
				<div id="maps_container"></div>
				<center><button onclick="resetPins()" id="reset_location">Reset Pin</button>
				<button id="save_location" onclick="saveLocationBtn()" class="save_button">Save Location</button></center>
			</div>
			<div id="add_state_province_cong_container">
				<div id="add_s_p_c_1">
					<center><h2 class="tags">Add new State or Province</h2></center>
					<center><input type="text" id="state" class="input" placeholder="State or Province"><br></center>
					<center><p id="state_or_province_message"></p></center>
					<center><button id="save_state" class="save_button" onclick="saveState()">Save State or Province</button></center>
				</div>
				<div id="add_s_p_c_2">
					<center><h2 class="tags">Add new Congregation</h2></center>
					<center><input type="text" id="congregation" class="input" placeholder="Congregation"><br></center>
					<center><p id="cong_message"></p></center>
					<center><button id="save_congregation" class="save_button" onclick="saveCongregation()">Save Congregation</button></center>
				</div>
			</div>
		</div>
		
		<div id="edit_location_div">
			
			<div id="edit_location_box">
				<center><h2>Edit or Delete Locations</h2></center>
			
				<center><input type="text" class="input" placeholder="Search for location", id="edit_search_location" onkeyup="searchForPlacesToEdit()"></center>
				<div id="drop_down_location_edit_div">
					<ul id="locations_to_edit_ul"></ul>
				</div>

				<div id="verify_edit_location_div">

					<div id="edit_location_1">
						<input type="text" placeholder="First Name" id="edit_first_name" class="input"><br>
						<input type="text" placeholder="Last Name" id="edit_last_name" class="input"><br>
						<input type="text" placeholder="Address" id="edit_address" class="input"><br>
						<input type="text" placeholder="City" id="edit_city" class="input"><br>
					</div>

					<div id="edit_location_2">
						<h4 class="tags">Select State or Province</h4>
						<select id="edit_state_select" class="select"></select>
						<h4 class="tags">Select Congregation</h4>
						<select id="edit_cong_select" class="select"></select>
						<div id="dispute_div">
							<p id="dispute_explain">There maybe an error with this location,<br>please close the dispute before updating.</p>
							<center><button onclick="closeDispute()" id="close_dispute_btn">Close dispute</button></center>
						</div>
						<p id="dispute_message">Test</p>
					</div>

				</div>

				<center><h3 id="edit_location_message"></h3></center>

				<center><div id="edit_map_location"></div></center>

				<center><input value="Update Location" class="save_button" id="update_location_btn" type="button" onclick="updateLocation()"></center>

				<center><button onclick="deleteThisLocation()" id="delete_this_location_btn">Delete this location</button></center>
			</div>
			
			<div id="edit_congs_box">
				<center><h2>Edit Congregations</h2></center>
			
				<center><input type="text" class="input" placeholder="Search for congregation", id="edit_search_cong" onkeyup="searchForCongsToEdit()"></center>
				<div id="drop_down_cong_edit_div">
					<ul id="cong_to_edit_ul"></ul>
				</div>

				<div id="edit_cong_div">
					<input type="text" class="input" id="cong_to_edit" placeholder="Congregation"><br>
					<input type="button" class="save_button" value="Update Congregation" onclick="updateCong()">
				</div>
				<p id="edit_cong_message"></p>
			</div>
			
		</div>
	
		<div id="check_feedback_div">
			<div id="unresolved_feedback_box">
				<center><h2 id="unresolved_feedback_h">Unresolved Errors</h2></center>
				<center><h4 id="no_feedback_tv">No errors to resolve</h4></center>
				<ul id="unresolved_feedback_ul"></ul>
			</div>
			
			<div id="resolved_feedback_box">
				<center><h2 id="resolved_feedback_h">Resolved Errors</h2></center>
				<center><h4 id="feedback_resolved_tv">No errors resolved</h4></center>
				<ul id="resolved_feedback_ul"></ul>
			</div>
			
			<div id="view_feedback">
				<div id="feedback_content">
					<center><h3>Error</h3></center>
					<p id="feedback_whats_wrong" class="show_feedback_p"></p>
					<b><p id="feedback_notes" class="show_feedback_p"></p></b>
					<p id="feedback_date" class="show_feedback_p"></p>
					<center><h3>Location in question</h3></center>
					<p id="first_and_last_name" class="show_feedback_p">test</p>
					<p id="feedback_congregation" class="show_feedback_p">test</p>
					<p id="feedback_address" class="show_feedback_p">test</p>
					<p id="feedback_city_and_state" class="show_feedback_p">test</p>
				</div>
					<div id="feedback_button_bar">
						<button id="feedback_cancel" onclick="feedback_cancel()">Cancel</button>
						<button id="feedback_mark_resolved" onclick="markResolved()">Mark resolved</button>
						<button id="feedback_edit_location" onclick="feedbackEditLocation()">Edit Location</button>
					</div>
			</div>
			
			<div id="loading_feedback">
				<div id="feedback_loader"></div>
			</div>
		</div>
		
		<div id="get_more_credits_container">
			<div id="added_to_cart_div">
				<h3 id="item_added_to_cart"></h3>
				<button onclick="cancelCheckoutDialog()" id="cancel_checkout_dialog">Add More</button>
				<button onclick="checkout()" id="checkout_btn">Checkout</button>
			</div>
			<center><h2>Select a package</h2></center>
			<div id="tier_container">
				<div class="tier" id="five">
					<div id="tier_five">
						<h4 class="tier_label">5</h4>
						<h4 class="house_holds_label">Credits</h4>
					</div>
					<div>
						<img id="shopping_cart_img" src="res/shopping_cart.jpg" onclick="five()">
						<p class="price_label">$25</p>
					</div>
				</div>
				<div class="tier" id="fifteen">
					<div id="tier_fifteen">
						<h4 class="tier_label">15</h4>
						<h4 class="house_holds_label">Credits</h4>
					</div>
					<div>
						<img id="shopping_cart_img" src="res/shopping_cart.jpg" onclick="fifteen()">
						<p class="price_label">$75</p>
					</div>
				</div>
				<div class="tier" id="twentyfive">
					<div id="tier_twentyfive">
						<h4 class="tier_label">25</h4>
						<h4 class="house_holds_label">Credits</h4>
					</div>
					<div>
						<img id="shopping_cart_img" src="res/shopping_cart.jpg" onclick="twentyfive()">
						<p class="price_label">$125</p>
					</div>
				</div>
				<div class="tier" id="fifty">
					<div id="tier_fifty">
						<h4 class="tier_label">50</h4>
						<h4 class="house_holds_label">Credits</h4>
					</div>
					<div>
						<img id="shopping_cart_img" src="res/shopping_cart.jpg" onclick="fifty()">
						<p class="price_label">$250</p>
					</div>
				</div>
				<div class="tier" id="seventyfive">
					<div id="tier_seventyfive">
						<h4 class="tier_label">75</h4>
						<h4 class="house_holds_label">Credits</h4>
					</div>
					<div>
						<img id="shopping_cart_img" src="res/shopping_cart.jpg" onclick="seventyfive()">
						<p class="price_label">$375</p>
					</div>
				</div>
			</div>
		</div>
		
		<div id="information_div">
			<center><h2>Tips and Information</h2></center>
			<ul id="info_ul">
				<li class="info_li">When you first began to enter your locations, your congregation most likely will not be one of the options in the congregation dropdown.  On the bottom of 'Add location' page there is an option to add a new congregation, go ahead and add yours.</li>
				<li class="info_li">The information from 'Check Location Errors' comes directly from when a user reports an error on one of the locations that you entered.</li>
				<li class="info_li">When you are viewing your location errors and mark one as resolved, the location is not actually updated, it just lets CGCM Map know that you are aware of a problem with one of your locations.  To actually update the location, you must edit it, and then mark it that the error is resolved.</li>
				<li class="info_li">We encourage you to add your church, school and the locations of the businesses in your congregation. But when you add a location, the first and last name must be filled before adding, so just split the name in half the best you can so you can fill both blanks.</li>
				<li class="info_li">When someone in your congregation moves away, you must delete that location. Although this may seem a little strange to some (Why no just edit the location?),  CGCM Map is designed so you only have to manage you own congregations locations. So therefore the person who moved away is no longer your responsibility.</li>
				<li class="info_li">Location credits are non-refundable</li>
				<li class="info_li">When you delete a location, you get back the credit you used.</li>
			</ul>
		</div>
		
		<div id="profile_div">
			<center><h2>Edit profile</h2></center>
			<div id="edit_profile_container">
				<div>
					<input id="profile_first_name" placeholder="First Name" class="input"><br>
					<input id="profile_last_name" placeholder="Last Name" class="input"><br>
					<input id="profile_address" placeholder="Address" class="input"><br>
					<input id="profile_city" placeholder="City" class="input"><br>
				</div>
				<div>
					<input id="profile_state" placeholder="State" class="input"><br>
					<input id="profile_cong" placeholder="Congregation" class="input"><br>
					<input id="profile_email" placeholder="Email" class="input"><br>
					<input id="profile_phone" placeholder="Phone" class="input"><br>
				</div>
			</div>
			<center><p id="update_profile_message"></p></center>
			<center><button onclick="updateProfile()" id="update_profile_btn">Update Profile</button></center>
			<div id="extra_profile_info_div">
				<center><p id="profile_location_credits_remaining"></p></center>
				<center><p id="date_created"></p></center>
			</div>
		</div>
		
		<div id="left_content_div"></div>
	</div>

	<script>
		
		// Member variables
		var mMap;
		var mLatnLngFromAddress = {};
		var mNewLatnLngFromMap = {};
		var mEditLatnLngFromAddress = {};
		var mEditNewLatnLngFromMap = {};
		var markersArray = [];
		var mCongregationMap = {};
		var mCongregationMapIds = {};
		var mCongregationArray = [];
		var mStatesMap = {};
		var mStateMapIds = {};
		var mStatesArray = [];
		var mLocationId;
		var mSelectedDate;
		var mUserId;
		var mCurrentUserId;
		var mLocationThatCurrentUserPutIn = {};
		var mLocationFeedbackArray = {};
		var mIsEditingFromCheckFeedback = false;
		var mStateIdToUpdate;
		var mCongIdToUpdate;
		var mLocationCredits;
		var mCongregationalAgentObjectId;
		var mSelectedLocationFeedbackId;
		var mCurrentUserArray = [];
		
		// hide elements that are not needed
		document.getElementById("maps_div").style.display = "none";
		document.getElementById("edit_location_div").style.display = "none";
		document.getElementById("check_feedback_div").style.display = "none";
		document.getElementById("get_more_credits_container").style.display = "none";
		document.getElementById("information_div").style.display = "none"
		document.getElementById("shadow_div").style.visibility = "hidden";
		document.getElementById("cong_message").style.display = "none";
		document.getElementById("state_or_province_message").style.display = "none";
		document.getElementById("delete_this_location_btn").style.display = "none";
		document.getElementById("edit_cong_message").style.display = "none";
		document.getElementById("edit_location_message").style.display = "none";
		document.getElementById("add_s_p_c_1").style.display = "none";
		document.getElementById("add_location_loader").style.display = "none";
		document.getElementById("profile_div").style.display = "none";

		
		document.onclick = closeMenus;
	
		/*
			*****  CODE USED FOR MORE THAN ONE ADMIN ACTIVITY  *****
		*/
		var database = firebase.database();
		firebase.auth().onAuthStateChanged(function(user) {
			if (user) {
				
				mCurrentUserId = user.uid;
				database.ref('locationFeedback').child(mCurrentUserId).orderByChild("date").on('value', function(snapshot){
					mLocationFeedbackArray = snapshotToArray(snapshot);
					refreshFeedbackUls();
				})
				
				database.ref('locations').orderByChild("userId").equalTo(mCurrentUserId).on('value', function(snapshot){
					mLocationThatCurrentUserPutIn = snapshotToArray(snapshot);
				});
				
				database.ref('congregationalAgents').orderByChild("userId").equalTo(mCurrentUserId).on('value', function(snapshot){
					var array = snapshotToArray(snapshot);
					
					mCurrentUserArray = array[0];
					
					mLocationCredits = array[0].locationCredits;
					mCongregationalAgentObjectId = array[0].congAgentObjectKey;
					
					document.getElementById("location_credits_remaining").innerHTML = "Location credits remaining: " + mLocationCredits;
					
					document.getElementById("loading_div").style.display = "none";
				
				})
			} else {
				mCurrentUserId = null;
			}
		});
		
		function openNav() {
			document.getElementById("shadow_div").style.visibility = "visible";
			document.getElementById("side_nav").style.visibility = "visible";
			document.getElementById("side_nav").style.width = "300px";
		}

		function closeNav() {
			document.getElementById("shadow_div").style.visibility = "hidden";
			document.getElementById("side_nav").style.width = "0";
		}
		
		function setMessage(id, message, type){
			var messageCenter = document.getElementById(id);
			messageCenter.style.display = "block";
			messageCenter.style.opacity = 1;
			messageCenter.style.filter = 'alpha(opacity=' + 1 * 100 + ")";
			messageCenter.innerHTML = message;
			switch(type){
				case 0:
					// Error
					messageCenter.style.color = "#B71C1C";
					messageCenter.style.backgroundColor = "#E57373";
					break;
				case 1:
					// Not an Error
					messageCenter.style.color = "#1B5E20";
					messageCenter.style.backgroundColor = "#66BB6A";
					break;
				case 2:
					messageCenter.style.color = "#3b3b3b";
					messageCenter.style.backgroundColor = "#f5f5f5";
					break;
				default:
					messageCenter.style.color = "white";
					messageCenter.style.backgroundColor = "white";
			}
			setTimeout(function(){ 
				fade(messageCenter); 
			}, 2000);
		}
		
		function isNotCapital(word){
		  return word[0] !== word[0].toUpperCase();
		}
		
		function capitalizeFirstLetter(string) {
			return string.charAt(0).toUpperCase() + string.slice(1);
		}
		
		function closeMenus(e){
			if(e.target.id === "shadow_div"){
			
				var check_feedback = document.getElementById("view_feedback");
				var style = window.getComputedStyle(check_feedback);
				if(style.visibility === 'visible'){
					document.getElementById("shadow_div").style.visibility = "hidden";
					check_feedback.style.visibility = "hidden";
					
					document.getElementById("loading_feedback").style.visibility = "hidden";
				}
				
				// close nav drawer
				var nav_drawer = document.getElementById("side_nav");
				var nav_style = window.getComputedStyle(nav_drawer);
				if(nav_style.width !== '0px'){
					closeNav();
				}
				
				var location_credits = document.getElementById("added_to_cart_div");
				var credits_style = window.getComputedStyle(location_credits);
				if(credits_style.width !== "visible"){
					location_credits.style.visibility = "hidden"
				}

				
			}	
		}
		
		function shoppingCart(){
			closeNav();
			location.href = "checkout.html"
		}
		
		database.ref('congregations').orderByChild("congregation").on('value', function(snapshot){
			var congSelect = document.getElementById("cong_select");
			congSelect.innerHTML = "";
			parseCongSnapshot(snapshot);
		});
		
		database.ref('stateOrProvince').orderByChild("state").once('value').then(function(snapshot){
			var congSelect = document.getElementById("state_select");
			congSelect.innerHTML = "";
			parseStateSnapshot(snapshot);
		});
		
		
		/*
			*****  ADD LOCATIONS CODE   *****
		*/
		
		function saveLocationBtn(){
			var firstName = document.getElementById('first_name').value;
			var lastName = document.getElementById('last_name').value;
			var address = document.getElementById('address').value;
			var city = document.getElementById('city').value;
			var state = getSelectedText('state_select');
			var cong = getSelectedText('cong_select');
            
            if(firstName.length == 0 || lastName.length == 0 || address.length == 0 || city.length == 0 || state.length == 0 || cong.length == 0){
                setMessage("message_center_add_location", "Please fill all the blanks", 0);
				return;
            }
            
			var congId = mCongregationMap[cong];
			var stateId = mStatesMap[state];

			var userId = firebase.auth().currentUser.uid;
			
			var lat;
			var long;
			
			if(mNewLatnLngFromMap.lat == null || mNewLatnLngFromMap.lng == null){
				lat = mLatnLngFromAddress.lat;
				long = mLatnLngFromAddress.lng;
			}else{
				lat = mNewLatnLngFromMap.lat;
				long = mNewLatnLngFromMap.lng;
			}
			
			var capFirstName = capitalizeFirstLetter(firstName);
			var capLastName = capitalizeFirstLetter(lastName);
			var capCity = capitalizeFirstLetter(city);
			
			saveLocation(lat, long, capFirstName, capLastName, capCity, stateId, address, congId, userId, Date.now());
         
            document.getElementById('first_name').value = "";
			document.getElementById('last_name').value = "";
			document.getElementById('address').value = "";
			document.getElementById('city').value = ""
			
			document.getElementById("maps_div").style.display = "none";
			setMessage("message_center_add_location", "Location saved successfully", 1);
			
			deleteMarkers();
			
			mLatnLngFromAddress = {};
			mNewLatnLngFromMap = {};
		}
		
	    function saveLocation(varLatitude, varLongitude, varFirstName, varLastName, varCity, varState, varAddress, varCong, varUserId, varDate){
			var firstName = capitalizeFirstLetter(varFirstName);
			var lastName = capitalizeFirstLetter(varLastName);
			var city = capitalizeFirstLetter(varCity);
			var firstAndLastName = firstName + " " + lastName;
            var ref = firebase.database().ref('locations').push();
            var key = ref.getKey();
            ref.set({
				firstAndLastName: firstAndLastName,
				date: varDate,
                latitude: varLatitude,
                longitude: varLongitude,
				firstName: firstName,
				lastName: lastName,
				address: varAddress,
				city: city,
				congregation: varCong,
				state: varState,
                locationId: key,
				userId: varUserId,
				isDisputeOpen: false
            });
			
			var updateCountRef = firebase.database().ref('congregationalAgents').child(mCongregationalAgentObjectId).child("locationCredits");
			updateCountRef.once('value').then(function(snapshot){
				var currentVal = snapshot.val();
				var countToUpdate = currentVal - 1;
				updateCountRef.set(countToUpdate);
			})
        }
		
		function saveCongregation(){
			var cong = document.getElementById("congregation").value;
			if(cong.length == 0){
				setMessage("cong_message", "Please fill the blank", 0);
				return;
			}
			if(mCongregationArray.indexOf(cong) > -1){
				setMessage("cong_message", "Congregation already added", 0);
				return;
			}
			var capCong = capitalizeFirstLetter(cong);
			
			var ref = firebase.database().ref('congregations').push();
			var key = ref.getKey();
			ref.set({
				congregationId: key,
				congregation: capCong
			});
			setMessage("cong_message", capCong + " was added successfully", 1);
			document.getElementById("congregation").value = "";
		}
		
		function getSelectedText(elementId) {
			var elt = document.getElementById(elementId);

			if (elt.selectedIndex == -1)return null;

			return elt.options[elt.selectedIndex].text;
		}
		
		function verify_location(){

			var loader = document.getElementById("add_location_loader");
			loader.style.display = "block";

			var firstName = document.getElementById('first_name').value;
			var lastName = document.getElementById('last_name').value;
			var address = document.getElementById('address').value;
			var city = document.getElementById('city').value;
			var state = getSelectedText('state_select');
			var cong = getSelectedText('cong_select');

			if(firstName.length == 0 || lastName.length == 0 || address.length == 0 || city.length == 0 || state.length == 0 || cong.length == 0){
				loader.style.display = "none";
				setMessage("message_center_add_location", "Please fill all the blanks",0);
				return;
			}
			
			var updateCountRef = firebase.database().ref('congregationalAgents').child(mCongregationalAgentObjectId).child("locationCredits");
			updateCountRef.once('value').then(function(snapshot){
				var currentVal = snapshot.val();
				if(currentVal == 0){
					loader.style.display = "none";
					setMessage("message_center_add_location", "You are out of location credits", 0);
				}else{
					var databaseRef = firebase.database().ref('locations').orderByChild("firstName").equalTo(firstName);
					databaseRef.once('value').then(function(snapshot){
						var array = snapshotToArray(snapshot);
						if(areNamesInArray(array, firstName, lastName)){
							setMessage("message_center_add_location", "This person's location is already saved", 0);
							document.getElementById("maps_div").style.display = "none";
							loader.style.display = "none";

						}else{
							var addressString = address.split(" ");
							var finishedAddresString = "";
							var cityAndStateString = "";
							for(var i=0; addressString.length > i; i++){
								var item = addressString[i];
								finishedAddresString = finishedAddresString + item + "+";	
							}

							cityAndStateString = city + "+" + state;

							var apiKey = "&key=AIzaSyA9GSNr_y7G9nRoTXnJ7wNY9N7ACt9u8SA";
							var baseUrl = "https://maps.googleapis.com/maps/api/geocode/json?address=";
							var url = baseUrl + finishedAddresString + cityAndStateString + apiKey;
							var request = new XMLHttpRequest();
							request.onreadystatechange = function(){
								if(this.readyState == 4 && this.status == 200){
									var json = JSON.parse(this.responseText);
									var successCode = json.status;
									if(successCode === "ZERO_RESULTS"){
										setMessage("message_center_add_location", "Address is unknown, please try a different one", 0);
										loader.style.display = "none";
									}else{
										document.getElementById("maps_div").style.display = "block";
										var lat_n_long = json.results[0].geometry.location;

										var lat = lat_n_long.lat;
										var long = lat_n_long.lng;

										var congId = mCongregationMap[cong];
										var stateId = mStatesMap[state];

										var userId = firebase.auth().currentUser.uid;

										mLatnLngFromAddress = {lat: lat, lng: long};

										mMap= new google.maps.Map(document.getElementById('maps_container'), {
											zoom: 18,
											center: mLatnLngFromAddress,
											mapTypeId: 'satellite'
										});

										var marker = new google.maps.Marker({
											position: mLatnLngFromAddress,
											map: mMap
										});
										markersArray.push(marker);
										setMapOnAll(mMap);

										google.maps.event.addListener(mMap, "click", function (e) {

											deleteMarkers();

											//lat and lng is available in e object
											var latLng = e.latLng;
											mNewLatnLngFromMap = {lat: latLng.lat(), lng: latLng.lng()}

											var marker = new google.maps.Marker({
												position: mNewLatnLngFromMap,
												map: mMap
											});
											markersArray.push(marker);
											setMapOnAll(mMap);

										});	
										
										loader.style.display = "none";

									}

								}else{

								}
							}
							request.open('GET', url);
							request.send();
						}
					})		
				}
			})
		}
		
		function resetPins(){
			deleteMarkers();
			var marker = new google.maps.Marker({
			  position: mLatnLngFromAddress,
			  map: mMap
			});
			markersArray.push(marker);
			setMapOnAll(mMap);
			mMap.panTo(mLatnLngFromAddress);
		}
		
		function parseCongSnapshot(snapshot) {
			mCongregationArray = [];
			mCongregationMap = {};
			mCongregationMapIds = {};
			var congSelect = document.getElementById("cong_select");
			congSelect.innerHTML = "";
	   		snapshot.forEach(function(childSnapshot) {
		   		var name = childSnapshot.val().congregation;
		   		var nameId = childSnapshot.val().congregationId;

		   		var node = document.createElement('option');
				node.value = name;
				node.innerHTML = name;
				congSelect.appendChild(node);

		   		mCongregationArray.push(name);
		   		mCongregationMap[name] = nameId;
				mCongregationMapIds[nameId] = name;
    	   	});

	     };
		
		function parseStateSnapshot(snapshot){
			mStatesArray = [];
			mStatesMap = {};
			mStateMapIds = {};
			var stateSelect = document.getElementById("state_select");
			stateSelect.innerHTML = "";
			snapshot.forEach(function(childSnapshot){
				var name = childSnapshot.val().state;
				var nameId = childSnapshot.val().stateId;
				
				var node = document.createElement('option');
				node.value = name;
				node.innerHTML = name;
				
				stateSelect.appendChild(node);
				
				mStatesArray.push(name);
				mStatesMap[name] = nameId;
				mStateMapIds[nameId] = name;
				
			})
		};
       
		function setMapOnAll(map) {
			for (var i = 0; i < markersArray.length; i++) {
			  markersArray[i].setMap(map);
			}
		  }
		
		function capitalizeFirstLetter(string) {
			return string.charAt(0).toUpperCase() + string.slice(1);
		}

		function deleteMarkers() {
			setMapOnAll(null);
			markersArray = [];
		  }
		
		function fade(element) {
			var op = 1;  // initial opacity
			var timer = setInterval(function () {
				if (op <= 0.1){
					clearInterval(timer);
					element.style.display = 'none';
				}
				element.style.opacity = op;
				element.style.filter = 'alpha(opacity=' + op * 100 + ")";
				op -= op * 0.1;
			}, 30);
		}
		
		function snapshotToArray(snapshot) {
			var returnArr = [];

			snapshot.forEach(function(childSnapshot) {
				var item = childSnapshot.val();
				item.key = childSnapshot.key;

				returnArr.push(item);
			});

			return returnArr;
		};

		function areNamesInArray(array, firstNameToTest, lastNameToTest){
			for(var i=0; i < array.length; i++){
				var firstName = array[i].firstName;
				var lastName = array[i].lastName;
				
				if(firstName == firstNameToTest && lastName == lastNameToTest){
					return true;
				}
			}
			return false;
		}
		
		function navAddLocation(){
			markersArray = [];
			closeNav();
			document.getElementById("profile_div").style.display = "none";
			document.getElementById("add_location_div_container").style.display = "block";
			document.getElementById("edit_location_div").style.display = "none";
			document.getElementById("check_feedback_div").style.display = "none";
			document.getElementById("get_more_credits_container").style.display = "none";
			document.getElementById("information_div").style.display = "none"
		}
		
		
		/*
			*****  EDIT ITEMS CODE   *****
		*/
		function navEditLocation(){
			markersArray = [];
			closeNav();
			document.getElementById("profile_div").style.display = "none";
			document.getElementById("information_div").style.display = "none"
			document.getElementById("edit_location_div").style.display = "block";
			document.getElementById("add_location_div_container").style.display = "none";
			document.getElementById("get_more_credits_container").style.display = "none";
			document.getElementById("check_feedback_div").style.display = "none";
			document.getElementById("verify_edit_location_div").style.display = "none";
			document.getElementById("edit_map_location").style.display = "none";
			document.getElementById("update_location_btn").style.display = "none";
			document.getElementById("edit_cong_div").style.display = "none";
			document.getElementById("drop_down_cong_edit_div").style.display = "none";
			document.getElementById("drop_down_location_edit_div").style.display = "none";
			document.getElementById("dispute_div").style.display = "none";
			document.getElementById("dispute_message").style.display = "none";
			
			var editSelectState = document.getElementById("edit_state_select");
			var editSelectCong = document.getElementById("edit_cong_select");
			
			editSelectCong.innerHTML = "";
			editSelectState.innerHTML = "";
			
			for(var i=0; mStatesArray.length > i; i++){
				var name = mStatesArray[i];
				var node = document.createElement('option');
				node.value = name;
				node.innerHTML = name;
				
				editSelectState.appendChild(node);
			}
			
			for(var i=0; mCongregationArray.length >i; i++){
				var cong = mCongregationArray[i];
				var node = document.createElement('option');
				node.value = cong;
				node.innerHTML = cong;
				
				editSelectCong.appendChild(node);
			}
		}
		
		function searchForPlacesToEdit(){
			
			var searchToEditItem = capitalizeFirstLetter(document.getElementById("edit_search_location").value);
			
			var locationsToEdit = document.getElementById("locations_to_edit_ul");

			document.getElementById("verify_edit_location_div").style.display = "none";
			document.getElementById("edit_map_location").style.display = "none";
			document.getElementById("update_location_btn").style.display = "none";
			document.getElementById("delete_this_location_btn").style.display = "none";
			
			locationsToEdit.innerHTML = "";
			
			if(searchToEditItem.length == 0 || searchToEditItem == null){
				locationsToEdit.style.display = "none";
				document.getElementById("drop_down_location_edit_div").style.display = "none";
				return;
			}
			
				document.getElementById("drop_down_location_edit_div").style.display = "block";

				locationsToEdit.style.display = "block";
				
				var searchAndFoundItems = [];
		
			
				for(var t=0; mLocationThatCurrentUserPutIn.length >t; t++){
					var array = mLocationThatCurrentUserPutIn[t];
					var firstName = array.firstName;
					if(checkIfNameStartsWithString(searchToEditItem, firstName)){
						searchAndFoundItems.push(array);  
					}
				};
			
			if(searchAndFoundItems.length == 0){
				setMessage("edit_location_message", "No results", 2);
				document.getElementById("drop_down_location_edit_div").style.display = "none";
				return;
			}
				for(var j=0; searchAndFoundItems.length > j; j++){
					var itemArray = searchAndFoundItems[j];
					var firstName = itemArray.firstName;
					var lastName = itemArray.lastName;
					var locationId = itemArray.locationId;
					
					var name = firstName + " " + lastName;

					var ul = document.getElementById('locations_to_edit_ul');
					var li = document.createElement("li");
					li.appendChild(document.createTextNode(name));
					li.setAttribute("id", "edit_li_items");
					li.setAttribute("myLocationId", locationId);
					ul.appendChild(li);
				}

				var list = document.getElementById("locations_to_edit_ul");

				for(i=0;i<=list.childElementCount-1;i++){
					list.children[i].addEventListener("click",itemClicked);
				}

				function itemClicked(){
					var locationId = this.getAttribute("myLocationId");
					var ref = firebase.database().ref("locations/" + locationId);
					ref.once('value').then(function(snapshot){
						
						document.getElementById("verify_edit_location_div").style.display = "block";
						document.getElementById("locations_to_edit_ul").style.display = "none";
						document.getElementById("edit_search_location").value = "";
						document.getElementById("edit_map_location").style.display = "block";
						document.getElementById("update_location_btn").style.display = "block";
						document.getElementById("delete_this_location_btn").style.display = "block";

						var array = snapshotToArray(snapshot);
						
						var firstName = array[5];
						var lastName = array[7];
						var address = array[0];
						var state = array[11];
						var city = array[1];
						var cong = array[2];
						var lat = array[8];
						var long = array[10];
						mLocationId = array[9];
						mUserId = array[12];
						mSelectedDate = array[3];
						
						var isDisputeOpen = array[6];
						if(isDisputeOpen){
							document.getElementById("update_location_btn").style.display = "none";
							document.getElementById("dispute_div").style.display = "block";
						}
						
						document.getElementById("edit_first_name").value = firstName;
						document.getElementById("edit_last_name").value = lastName;
						document.getElementById("edit_address").value = address;
						document.getElementById("edit_city").value = city;
						
						var congName = mCongregationMapIds[cong];
						var stateName = mStateMapIds[state];
				
						document.getElementById("edit_state_select").value = stateName;
						document.getElementById("edit_cong_select").value = congName;
						
						mEditLatnLngFromAddress = {lat: lat, lng: long};

						var edit_map = new google.maps.Map(document.getElementById('edit_map_location'), {
							zoom: 18,
							center: mEditLatnLngFromAddress,
							mapTypeId: 'satellite'
						});
						
						var marker = new google.maps.Marker({
							position: mEditLatnLngFromAddress,
							map: edit_map
						});
						
						markersArray.push(marker);
						setMapOnAll(edit_map);
						
						google.maps.event.addListener(edit_map, "click", function (e) {

							deleteMarkers();

							//lat and lng is available in e object
							var latLng = e.latLng;
							mEditNewLatnLngFromMap = {lat: latLng.lat(), lng: latLng.lng()}

							var marker = new google.maps.Marker({
								position: mEditNewLatnLngFromMap,
								map: edit_map
							});
							
							markersArray.push(marker);
							setMapOnAll(edit_map);

						});
						
					})
				}
		}
		
		function searchForCongsToEdit(){
			var searchToEditItem = capitalizeFirstLetter(document.getElementById("edit_search_cong").value);
			document.getElementById("edit_cong_div").style.display = "none";
			var editCongUl = document.getElementById("cong_to_edit_ul");
			editCongUl.innerHTML = "";
			if(searchToEditItem.length == 0 || searchToEditItem == null){
				document.getElementById("drop_down_cong_edit_div").style.display = "none";
				return;
			}
			
			editCongUl.style.display = "block";
			document.getElementById("drop_down_cong_edit_div").style.display = "block";

			var congsFound = [];
			
			for(var t=0; mCongregationArray.length >t; t++){
				var cong = mCongregationArray[t];
				if(checkIfNameStartsWithString(searchToEditItem, cong)){
					congsFound.push(cong); 
				}
			};
			
			for(var r=0; congsFound.length>r; r++){
				var cong = congsFound[r];
				var congId = mCongregationMap[cong];
				var li = document.createElement("li");
				li.appendChild(document.createTextNode(cong));
				li.setAttribute("id", "edit_li_items");
				li.setAttribute("congId", congId);
				li.setAttribute("cong", cong);
				editCongUl.appendChild(li);
			}
			
			if(congsFound.length == 0){				
				document.getElementById("drop_down_cong_edit_div").style.display = "none";
				setMessage("edit_cong_message", "No results", 2);	
				return;
			}
			
			for(k=0;k<=editCongUl.childElementCount-1;k++){
				editCongUl.children[k].addEventListener("click",itemClicked);
			}
			
			function itemClicked(){
				document.getElementById("edit_search_cong").value = "";
				editCongUl.style.display = "none";
				mCongIdToUpdate = this.getAttribute("congId");
				var cong = this.getAttribute("cong");
				document.getElementById("edit_cong_div").style.display = "block";
				document.getElementById("cong_to_edit").value = cong;
			}
			
		}
		
		function updateCong(){
			var congEl = document.getElementById("cong_to_edit");
			var cong = congEl.value;
			if(cong.length == 0){
				setMessage("edit_cong_message", "Please fill the blank", 0);
				return;
			}
			if(isNotCapital(cong)){
				setMessage("edit_cong_message", "Congregation must be capitalized", 0);
				return;
			}
			if(mCongIdToUpdate == undefined){
				setMessage("edit_cong_message", "There was an error", 0);
				return;
			}
			var ref = firebase.database().ref('congregations').child(mCongIdToUpdate);
			ref.set({
				congregationId: mCongIdToUpdate,
				congregation: cong
			});
			setMessage("edit_cong_message", cong + " was updated successfully", 1);
			congEl.value = "";
			document.getElementById("edit_cong_div").style.display = "none";
		}
		
		function updateLocation(){
			var firstName = document.getElementById("edit_first_name").value;
			var lastName = document.getElementById("edit_last_name").value;
			var address = document.getElementById("edit_address").value;
			var city = document.getElementById("edit_city").value;
			var state = getSelectedText("edit_state_select");
			var cong = getSelectedText("edit_cong_select");
			var congId = mCongregationMap[cong];
			var stateId = mStatesMap[state];
			var lat;
			var lng;
			
			if(firstName.length == 0 || lastName.length == 0 || address.length == 0 || city.length == 0 || state.length == 0 || cong.length == 0){
				return;
			}
			
			if(mEditNewLatnLngFromMap.lat == null || mEditNewLatnLngFromMap.lat == null){
				var lat = mEditLatnLngFromAddress.lat;
				var lng = mEditLatnLngFromAddress.lng;
			}else{
				var lat = mEditNewLatnLngFromMap.lat;
				var lng = mEditNewLatnLngFromMap.lng;
			}
			
			var firstAndLastName = firstName + " " + lastName;
			
			var ref = firebase.database().ref("locations/" + mLocationId);
			ref.set({
                latitude: lat,
                longitude: lng,
				firstName: firstName,
				lastName: lastName,
				address: address,
				city: city,
				isDisputeOpen: false,
				date: mSelectedDate,
				firstAndLastName: firstAndLastName,
				congregation: congId,
				state: stateId,
                locationId: mLocationId,
				userId: mUserId
            });

			document.getElementById("delete_this_location_btn").style.display = "none";
			document.getElementById("edit_first_name").value = "";
			document.getElementById("edit_last_name").value = "";
			document.getElementById("edit_address").value = "";
			document.getElementById("edit_city").value = "";
			
			mEditLatnLngFromAddress = {};
			mEditNewLatnLngFromMap = {};
			
			mUserId = null;
			mLocationId = null;
			
			markersArray = [];
			
			mSelectedDate = null;

			document.getElementById("verify_edit_location_div").style.display = "none";
			document.getElementById("edit_map_location").style.display = "none";
			document.getElementById("update_location_btn").style.display = "none";
			setMessage("edit_location_message", "Location updated successfully", 1);
				
			}
		
		function checkIfNameStartsWithString(str, name){
			var strLength = str.length;
			if(strLength <= name.length){
				var nameString = name.substr(0, strLength);	
				if(nameString === str){
					return true;
				}
			}
			return false;
		}
		
		function deleteThisLocation(){
			var ref = database.ref("locations").child(mLocationId);
			ref.remove();
			setMessage("edit_location_message", "Location deleted successfully", 1);
			document.getElementById("verify_edit_location_div").style.display = "none";
			document.getElementById("edit_map_location").style.display = "none";
			document.getElementById("update_location_btn").style.display = "none";
			document.getElementById("delete_this_location_btn").style.display = "none";
			var updateCountRef = firebase.database().ref('congregationalAgents').child(mCongregationalAgentObjectId).child("locationCredits");
			updateCountRef.once('value').then(function(snapshot){
				var currentVal = snapshot.val();
				var countToUpdate = currentVal + 1;
				updateCountRef.set(countToUpdate);
			})
		}
		
		function updateState(){
			var stateEl = document.getElementById("state_to_edit");
			var state = stateEl.value;
			if(state.length == 0){
				setMessage("edit_state_message", "Please fill the blank", 0);
				return;
			}
			if(isNotCapital(state)){
				setMessage("edit_state_message", "State or province must be capitalized", 0);
				return;
			}
			var ref = firebase.database().ref('stateOrProvince').child(mStateIdToUpdate);
			ref.set({
				stateId: mStateIdToUpdate,
				state: state
			});
			setMessage("edit_state_message", state + " was updated successfully", 1);
			stateEl.value = "";
			document.getElementById("edit_state_div").style.display = "none";
		}
		
		function closeDispute(){
			var ref = database.ref("locations").child(mLocationId).child("isDisputeOpen").set(false);
			document.getElementById("update_location_btn").style.display = "block";
			document.getElementById("dispute_div").style.display = "none";
			setMessage("dispute_message", "Dispute closed successfully", 1);
		}
		
		/*
			*****  CHECK FEEDBACK CODE   *****
		*/
		function parseDate(date){
		
			var date = parseFloat(date);
			var date = new Date(date);
			
			var year = date.getFullYear();
			var month = date.getMonth() + 1;
			var day = date.getDate();
			
			return month + "/" + day + "/" + year;
		}
		
		function navCheckFeedback(){
			closeNav();
			document.getElementById("profile_div").style.display = "none";
			document.getElementById("loading_feedback").style.visibility = "hidden";
			document.getElementById("view_feedback").style.visibility = "hidden";
			document.getElementById("check_feedback_div").style.display = "block";
			document.getElementById("edit_location_div").style.display = "none";
			document.getElementById("add_location_div_container").style.display = "none";
			document.getElementById("get_more_credits_container").style.display = "none";
			document.getElementById("information_div").style.display = "none"
			
			refreshFeedbackUls();
		}
		
		function refreshFeedbackUls(){
			var unresolvedFeedUl = document.getElementById("unresolved_feedback_ul");
			var resolvedFeedUl = document.getElementById("resolved_feedback_ul");
			unresolvedFeedUl.innerHTML = "";
			resolvedFeedUl.innerHTML = ""
			
			document.getElementById("feedback_resolved_tv").style.display = "block";
			document.getElementById("no_feedback_tv").style.display = "block";
			
			for(var k=0; mLocationFeedbackArray.length > k; k++){
				var itemArray = mLocationFeedbackArray[k];
				var whatsWrong = itemArray.whatsWrong;
				var isResolved = itemArray.isResolved;
				var locationId = itemArray.locationFeedbackKey;
				var feedbackKey = itemArray.feedbackKey;
				var date = itemArray.date;
				var notes = itemArray.notes;
				if(isResolved){
					document.getElementById("feedback_resolved_tv").style.display = "none";
					var li = document.createElement("li");
					li.appendChild(document.createTextNode(whatsWrong));
					li.setAttribute("feedbackKey", feedbackKey);
					li.setAttribute("id", "feedback_resolved_li");
					li.setAttribute("locationId", locationId);
					li.setAttribute("date", date);
					li.setAttribute("notes", notes);
					li.setAttribute("whatsWrong", whatsWrong);
					li.setAttribute("isResolved", "1");
					resolvedFeedUl.appendChild(li);
				}else{
					document.getElementById("no_feedback_tv").style.display = "none";
					var li = document.createElement("li");
					li.appendChild(document.createTextNode(whatsWrong));
					li.setAttribute("id", "feedback_not_resolved_li");
					li.setAttribute("feedbackKey", feedbackKey);
					li.setAttribute("locationId", locationId);
					li.setAttribute("date", date);
					li.setAttribute("notes", notes);
					li.setAttribute("whatsWrong", whatsWrong);
					li.setAttribute("isResolved", "0");
					unresolvedFeedUl.appendChild(li);	
				}
			}
			
			for(i=0;i<=unresolvedFeedUl.childElementCount-1;i++){
				unresolvedFeedUl.children[i].addEventListener("click",itemClicked);
			}
			
			for(i=0;i<=resolvedFeedUl.childElementCount-1;i++){
				resolvedFeedUl.children[i].addEventListener("click",itemClicked);
			}
			
			function itemClicked(){
				document.getElementById("loading_feedback").style.visibility = "visible";
				document.getElementById("shadow_div").style.visibility = "visible";
				document.getElementById("view_feedback").style.visibility = "visible";
				var locationKey = this.getAttribute("locationId");
				var millis = this.getAttribute("date");
				var date = parseDate(millis);
				var notes = this.getAttribute("notes");
				var whatsWrong = this.getAttribute("whatsWrong");
				var isResolved = this.getAttribute("isResolved");
				mSelectedLocationFeedbackId = this.getAttribute("feedbackKey");
				
				if(isResolved === "1"){
					document.getElementById("feedback_mark_resolved").style.display = "none";
					document.getElementById("feedback_edit_location").style.display = "none";
				}else{
					document.getElementById("feedback_mark_resolved").style.display = "inline-block";
					document.getElementById("feedback_edit_location").style.display = "inline-block";
				}
				document.getElementById("feedback_whats_wrong").innerHTML = whatsWrong;
				document.getElementById("feedback_notes").innerHTML = notes;
				document.getElementById("feedback_date").innerHTML = date;
				var ref = database.ref('locations').child(locationKey);
				ref.once('value').then(function(snapshot){
					document.getElementById("loading_feedback").style.visibility = "hidden";
					var array = snapshotToArray(snapshot);
					var address = array[0];
					var city = array[1];
					var stateId = array[10];
					var congId = array[2];
					var name = array[4];
					var state = mStateMapIds[stateId];
					var cong = mCongregationMapIds[congId];
					document.getElementById("first_and_last_name").innerHTML = name;
					document.getElementById("feedback_address").innerHTML = address;
					document.getElementById("feedback_city_and_state").innerHTML = city + ", " + state;
					document.getElementById("feedback_congregation").innerHTML= cong;
				})
			}
		}
		
		function feedback_cancel(){
			document.getElementById("shadow_div").style.visibility = "hidden";
			document.getElementById("view_feedback").style.visibility = "hidden";
			document.getElementById("loading_feedback").style.visibility = "hidden";
		}
		
		function markResolved(){
			document.getElementById("shadow_div").style.visibility = "hidden";
			document.getElementById("view_feedback").style.visibility = "hidden";
			document.getElementById("loading_feedback").style.visibility = "hidden";
			var ref = firebase.database().ref("locationFeedback").child(mCurrentUserId).child(mSelectedLocationFeedbackId).child("isResolved");
			ref.set(true);
		}
		
		function feedbackEditLocation(){
			document.getElementById("shadow_div").style.visibility = "hidden";
			document.getElementById("view_feedback").style.visibility = "hidden";
			document.getElementById("loading_feedback").style.visibility = "hidden";
			navEditLocation();
		}
		
		
		/*
			***** GET MORE LOCATION CREDITS *****
		*/
		function getMoreCredit(){
			closeNav();
			document.getElementById("profile_div").style.display = "none";
			document.getElementById("information_div").style.display = "none"
			document.getElementById("added_to_cart_div").style.display = "none";
			document.getElementById("edit_location_div").style.display = "none";
			document.getElementById("add_location_div_container").style.display = "none";
			document.getElementById("check_feedback_div").style.display = "none";
			document.getElementById("get_more_credits_container").style.display = "block";
		}
		
		function five(){
			addCreditsToCart(5);
		}
		
		function fifteen(){
			addCreditsToCart(15);
		}
		
		function twentyfive(){
			addCreditsToCart(25);
		}
		
		function fifty(){
			addCreditsToCart(50);
		}
		
		function seventyfive(){
			addCreditsToCart(75);
		}
		
		function addCreditsToCart(credits){
			document.getElementById("added_to_cart_div").style.visibility = "visible";
			document.getElementById("shadow_div").style.visibility = "visible";
			
			var ref = firebase.database().ref('shoppingCart').child(mCurrentUserId).push();
			var key = ref.getKey();
			
			ref.set({
				credits: credits,
				key: key
			})
			document.getElementById("added_to_cart_div").style.display = "block";
			var added_to_cart_text = credits + " location credits added to your cart";
			document.getElementById("item_added_to_cart").innerHTML = added_to_cart_text;
		}
		
		function cancelCheckoutDialog(){
			document.getElementById("shadow_div").style.visibility = "hidden";
			document.getElementById("added_to_cart_div").style.visibility = "hidden";
		}
		
		function checkout(){
			window.location = "checkout.html";
		}
		
		/*
			***** INFORMATION *****
		*/
		function information(){
			closeNav();
			document.getElementById("profile_div").style.display = "none";
			document.getElementById("information_div").style.display = "block"
			document.getElementById("edit_location_div").style.display = "none";
			document.getElementById("add_location_div_container").style.display = "none";
			document.getElementById("check_feedback_div").style.display = "none";
			document.getElementById("get_more_credits_container").style.display = "none";
		}
		
		/*
			***** PROFILE *****
		*/
		function profile(){
			closeNav();
			document.getElementById("profile_div").style.display = "block";
			document.getElementById("information_div").style.display = "none"
			document.getElementById("edit_location_div").style.display = "none";
			document.getElementById("add_location_div_container").style.display = "none";
			document.getElementById("check_feedback_div").style.display = "none";
			document.getElementById("get_more_credits_container").style.display = "none";
			document.getElementById("update_profile_message").style.display = "none";
			
			var firstName = mCurrentUserArray.firstName;
			var lastName = mCurrentUserArray.lastName;
			var address = mCurrentUserArray.address;
			var city = mCurrentUserArray.city;
			var state = mCurrentUserArray.state;
			var email = mCurrentUserArray.email;
			var phone = mCurrentUserArray.phone;
			var cong = mCurrentUserArray.congregation;
			var dateAdded = mCurrentUserArray.dateAdded;
			var locationCredits = mCurrentUserArray.locationCredits;
			
			document.getElementById("date_created").innerHTML = "A Congregational Agent since " + new Date(dateAdded).toDateString();
			document.getElementById("profile_location_credits_remaining").innerHTML = "Location credits remaining: " + locationCredits;
			
			document.getElementById("profile_first_name").value = firstName;
			document.getElementById("profile_last_name").value = lastName;
			document.getElementById("profile_address").value = address;
			document.getElementById("profile_city").value = city;
			document.getElementById("profile_state").value = state;
			document.getElementById("profile_email").value = email;
			document.getElementById("profile_phone").value = phone;
			document.getElementById("profile_cong").value = cong;
		}
		
		function updateProfile(){
			var firstName = document.getElementById("profile_first_name").value;
			var lastName = document.getElementById("profile_last_name").value;
			var address = document.getElementById("profile_address").value;
			var city = document.getElementById("profile_city").value;
			var state = document.getElementById("profile_state").value;
			var email = document.getElementById("profile_email").value;
			var phone = document.getElementById("profile_phone").value;
			var cong = document.getElementById("profile_cong").value;
			
			var firstName = capitalizeFirstLetter(firstName);
			var lastName = capitalizeFirstLetter(lastName);
			var city = capitalizeFirstLetter(city);
			var cong = capitalizeFirstLetter(cong);
			
			var dateAdded = mCurrentUserArray.dateAdded;
			var congAgentObjectKey = mCurrentUserArray.congAgentObjectKey;
			var firstAndLastName = firstName + " " + lastName;
			var locationCredits = mCurrentUserArray.locationCredits;
			var userId = mCurrentUserArray.userId;
			
			if(firstName.length == 0 || lastName.length == 0 || address.length == 0 || city.length == 0 || state.length == 0 || email.length == 0  || phone.length == 0){
				setMessage("update_profile_message", "Please fill the blanks", 0);
			} else{
				var ref = firebase.database().ref('congregationalAgents').child(congAgentObjectKey);
				ref.set({
					address: address,
					city: city,
					congAgentObjectKey : congAgentObjectKey,
					congregation: cong,
					dateAdded: dateAdded,
					email: email,
					firstAndLastName: firstAndLastName,
					firstName: firstName,
					lastName: lastName,
					locationCredits: locationCredits,
					phone: phone,
					state: state,
					userId: userId
				});
				setMessage("update_profile_message", "Profile updated successfully", 1);
			}
		}
	
		
	</script>
	
	<script 
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9GSNr_y7G9nRoTXnJ7wNY9N7ACt9u8SA">
	</script>

</body>
</html> 